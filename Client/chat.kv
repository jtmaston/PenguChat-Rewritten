#:import C kivy.utils.get_color_from_hex
#:import RiseInTransition kivy.uix.screenmanager.RiseInTransition
#:import Window kivy.core.window.Window
#:import Factory kivy.factory.Factory
#:import utils kivy.utils
#:import math math

<MessageBubble>
	size_hint: None, None
	padding: 10, 5
	spacing: 0, 0
    size: self.texture_size

<FileBubble>
    size_hint: None, None
	size: 120, 120

	Image:
	    source: 'Assets/file.png'
	    size: self.parent.size
        pos: self.parent.pos[0], self.parent.pos[1] + 10

<RightButton>
	size_hint_y: None
	size_hint_x: None
	padding: (20, 5)
    height: 40
    width: 40
    text_size: self.width, None

    canvas.before:
        Color:
            rgb: 0.096, 0.535, 0.656
        RoundedRectangle:
            radius: [(15, 15), (15, 15), (15, 15), (15, 15)]
            size: self.texture_size
            pos: self.pos

<Label>:
	font_size: 25

# despacito idk

<BlueButton@Button>:
	font_size: 30
	height: 90
	size_hint: (1, None)
	background_normal: 'assets/fallback.png'
	background_color: 0.181, 0.566, 0.755

<MenuButton>:
    background_normal: 'assets/fallback.png'
	background_color: 0, 0.413, 0.586
	canvas.before:
        Color:
            rgb: 0, 0.213, 0.286
        Line:
            width: 2
            rectangle: self.x, self.y, self.width, self.height

<TextInput>:
	font_size: 30
	multiline: False
	padding: [10, 0.5 * (self.height - self.line_height)]

<LoginLabel@Label>:
	color: 0, 0, 0, 1
	font_size: 25
	text_size: self.size
	halign: 'left'
	valign: 'middle'
	size_hint: (0.4, 1)

<LoginScreen@Screen>:
    on_pre_enter:
        Window.size = (500, 700)
	canvas:
		Rectangle:
			source:"assets/wallpaper.png"
			pos: self.pos
			size: self.size

<BackgroundContainer>
	canvas.before:
	    Color:
	        rgb: 0, 0.213, 0.286
	    Rectangle:
	        pos: self.pos
	        size: self.size

ScreenManager:
	transition: RiseInTransition()
	LoginScreen:
	    name:'loading_screen'
	    Image:
	        size: self.size
	        pos: self.pos
	        source: "Assets/Loading.gif"

	LoginScreen:
		name: 'login'
		on_leave:
            app.root.ids.loginUsr.text = ""
            app.root.ids.loginPass.text = ""
		BoxLayout:
		    padding: 10
	        spacing: 10
			orientation: 'vertical'
			GridLayout:
			    rows: 3
                cols: 2
                spacing: 10
                row_default_height: 90
                row_force_default: True
				LoginLabel:
					text: 'Username:'

				TextInput:
					id: loginUsr
					write_tab: False
					multiline: False

				LoginLabel:
					text: 'Password'

				TextInput:
					id: loginPass
					password: True
					write_tab: False
					multiline: False
					on_text_validate:
					    app.send_login_data()

			BlueButton:
				color: 0, 0, 0, 1
				text: 'Connect'
				on_press: app.send_login_data()
			BlueButton:
				text: 'Sign up'
				color: 0, 0, 0, 1
				on_press: app.root.current = 'signup'

	LoginScreen:
		name: 'signup'
		on_leave:
            app.root.ids.passwd.text = ""
            app.root.ids.passwd_r.text = ""
            app.root.ids.username.text = ""
		BoxLayout:
            padding: 10
	        spacing: 10
			orientation: 'vertical'
			GridLayout:
			    rows: 3
                cols: 2
                spacing: 10
                row_default_height: 90
                row_force_default: True
				LoginLabel:
					text: 'Username:'

				TextInput:
					id: username
					write_tab: False
					multiline: False

				LoginLabel:
					text: 'Password'

				TextInput:
					id: passwd
					password: True
					write_tab: False
					multiline: False

				LoginLabel:
					text: 'Password (again)'

				TextInput:
					id: passwd_r
					password: True
					write_tab: False
					multiline: False
					on_text_validate:
					    app.send_sign_up_data()

            BlueButton:
				text: 'Login'
				color: 0,0,0,1
				on_press: app.root.current = "login"

			BlueButton:
				text: 'Sign up'
				color: 0,0,0,1
				on_press: app.send_sign_up_data()


	Screen:
		on_enter:
			Window.size = (1080, 720)
			app.init_chat_room()

		on_leave:
		    app.hide_tk()

		name: 'chat_room'
		BoxLayout:
		    orientation: 'vertical'
            BackgroundContainer:
                orientation: 'horizontal'
                padding: 5
                spacing: 5
                BoxLayout:
                    size_hint_x: 0.3
                    orientation: 'vertical'

                    BackgroundContainer:
                        id: top_bar
                        height: 40
                        orientation: 'horizontal'
                        size_hint: (1, None)
                        padding: 0, 0, 0, 2

                        MenuButton:
                            id: request_button
                            width: 40
                            text: '2\n'
                            line_height:0.4
                            bold: True
                            font_size: 15
                            halign: 'center'
                            Image:
                                id: req
                                source: 'Assets/requests.png'
                                size: self.parent.size
                                pos: (self.parent.pos[0] - 1, self.parent.pos[1])

                        MenuButton:
                            width: 40
                            on_press: app.logout()
                            Image:
                                source: 'Assets/logout.png'
                                size: self.parent.size
                                pos: self.parent.pos
                        MenuButton:
                            width: 40
                            on_press: app.new_chat()
                            Image:
                                source: 'Assets/new_convo.png'
                                size: self.parent.size
                                pos: self.parent.pos

                    ScrollView:

                        GridLayout:
                            size_hint_y: None
                            height: self.minimum_height
                            cols: 1
                            rows: 0
                            row_default_height: '100dp'
                            row_force_default: True
                            spacing: 0, 5
                            id: sidebar

                BoxLayout:
                    padding: (1,0,0,0)
                    orientation: 'vertical'
                    canvas.before:
                        Color:
							rgb: 1, 1, 1
						Rectangle:
							source:"assets/large-wallpaper.png"
							pos: self.pos
							size: self.size
					ScrollView:
					    do_scroll_x: False
					    do_scroll_y: True

						GridLayout
							id: conversation
							size_hint_y: None
                            cols: 1
                            rows: 0
                            spacing: 0, 10
                            padding: 0, 10

                    BoxLayout:
                        padding: 0
                        spacing: 0
                        id: message_box
                        height: 50
                        orientation: 'horizontal'
                        size_hint: (1, None)
                        TextInput:
                            padding: 20, 0
                            canvas.before:
                                Color:
                                    rgb: 0, 0.213, 0.286
                                Line:
                                    width: 0.5
                                    rectangle: self.x, self.y, self.width, self.height
                            id: message_content
                            on_text_validate: app.send_text()
                        MenuButton:
                            on_press: app.send_text()
                            size_hint: (0.15, 1)
                            Image:
                                source: 'Assets/send.png'
                                size: self.parent.size
                                pos: self.parent.pos
                        MenuButton:
                            on_press: app.attach_file()
                            size_hint: (0.15, 1)
                            Image:
                                source: 'Assets/attach.png'
                                size: self.parent.size
                                pos: self.parent.pos
                          #  disabled: True