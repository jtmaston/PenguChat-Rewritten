#:import C kivy.utils.get_color_from_hex
#:import RiseInTransition kivy.uix.screenmanager.RiseInTransition
#:import Window kivy.core.window.Window
#:import RecycleView kivy.uix.recycleview
<BoxLayout>:
	padding: 10
	spacing: 10

<GridLayout>:
	rows: 3
	cols: 2
	spacing: 10
	row_default_height: 90
	row_force_default: True

<Label>:
	font_size: 25

<BlueButton@Button>:
	font_size: 30
	height: 90
	size_hint: (1, None)
	background_normal: 'assets/button_normal.png'
	background_down: 'assets/button_down.png'
	border: (2, 2, 2, 2)

<RedButton@Button>:
	font_size: 30
	height: 90
	size_hint: (1, None)
	background_normal: 'assets/red_button_normal.png'
	background_down: 'assets/red_button_down.png'
	border: (2, 2, 2, 2)

<List@Button>
	font_size:20
	height: 100
	size_hint: 1, None


<TextInput>:
	font_size: 30
	multiline: False
	padding: [10, 0.5 * (self.height - self.line_height)]

<ScrollView>:
	canvas.before:
		Color:
			rgb: 0, 0, 0
		Rectangle:
			pos: self.pos
			size: self.size
	size_hint: (0.4, 1)

<ChatLabel@Label>:
	text_size: (self.width, None)
	halign: 'left'
	valign: 'top'
	size_hint: (1, None)
	height: self.texture_size[1]
	markup: True

<LoginLabel@Label>:
	color: 0, 0, 0, 1
	font_size: 25
	text_size: self.size
	halign: 'left'
	valign: 'middle'
	size_hint: (0.4, 1)

<LoginScreen@Screen>:
    on_pre_enter:
        Window.size = (500, 700)
	canvas:
		Rectangle:
			source:"assets/wallpaper.jpg"
			pos: self.pos
			size: self.size

<MessageLabel@Label>
	text_size: self.width, None
	size_hint_y: None
	valign: 'center'
	height: self.texture_size[1]

ScreenManager:
	transition: RiseInTransition()

	LoginScreen:
	    name:'loading_screen'
	    Image:
	        size: self.size
	        pos: self.pos
	        source: "Assets/Loading.gif"

    LoginScreen:
		name: 'login_failed'
		BoxLayout:
			orientation: 'vertical'
			Label:
			    size_hint_y: 0.2
                canvas.before:
                    Color:
                        rgba: 1, 0, 0, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size
                text: "Username or password incorrect!"
			GridLayout:
				LoginLabel:
					text: 'Username:'

				TextInput:
					id: loginUsr_failed
					write_tab: False
					multiline: False

				LoginLabel:
					text: 'Password'

				TextInput:
					id: loginPass_failed
					password: True
					write_tab: False
					multiline: False
					on_text_validate: app.send_login_data()

			BlueButton:
				color: 0, 0, 0, 1
				text: 'Connect'
				on_press: app.send_login_data()
			BlueButton:
				text: 'Sign up'
				color: 0, 0, 0, 1
				on_press: app.sign_up_redirect()

	LoginScreen:
		name: 'login'
		BoxLayout:
			orientation: 'vertical'
			GridLayout:
				LoginLabel:
					text: 'Username:'

				TextInput:
					id: loginUsr
					write_tab: False
					multiline: False

				LoginLabel:
					text: 'Password'

				TextInput:
					id: loginPass
					password: True
					write_tab: False
					multiline: False
					on_text_validate: app.send_login_data()

			BlueButton:
				color: 0, 0, 0, 1
				text: 'Connect'
				on_press: app.send_login_data()
			BlueButton:
				text: 'Sign up'
				color: 0, 0, 0, 1
				on_press: app.sign_up_redirect()
	LoginScreen:
		name: 'signup'
		BoxLayout:
			orientation: 'vertical'
			GridLayout:
				LoginLabel:
					text: 'Username:'

				TextInput:
					id: username
					write_tab: False
					multiline: False

				LoginLabel:
					text: 'Password'

				TextInput:
					id: passwd
					password: True
					write_tab: False
					multiline: False

				LoginLabel:
					text: 'Password (again)'

				TextInput:
					id: passwd_r
					password: True
					write_tab: False
					multiline: False
					on_text_validate: app.send_sign_up_data()

			BlueButton:
				text: 'Sign up'
				color: 0,0,0,1
				on_press: app.send_sign_up_data()

		BoxLayout:
			orientation: 'vertical'

	Screen:
		on_pre_enter:
			Window.size = (1080, 720)
			app.load_friends()
			app.load_messages()
			app.hide_message_box()
		name: 'chat_room'
		BoxLayout:
		    orientation: 'vertical'
		    spacing: 0
		    padding: 0
		    BoxLayout:
		        canvas.before:
                    Color:
                        rgba: 0.5, 0.5, 0.5, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size
		        padding: 0
                id: top_bar
                height: 60
                orientation: 'horizontal'
                size_hint: (1, None)
                spacing: 0
                Button:
                    text: 'Requests'
                    id: new_convo_count
                    size_hint_x: 0.2
                Button:
                    text: 'Settings'
                    size_hint_x: 0.2
                Button:
                    text: 'Start a new chat!'
                    on_press: app.new_chat()

            BoxLayout:
                padding: 0
                spacing: 0
                orientation: 'horizontal'
                RecycleView:
                    canvas.before:
                        Color:
                            rgba: 0.5, 0.5, 0.5, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    id: friend_list
                    viewclass: 'Button'
                    RecycleBoxLayout:
                        size_hint_y: None
                        height: self.minimum_height
                        orientation: 'vertical'

                BoxLayout:
                    padding: 0
                    orientation: 'vertical'
                    canvas.before:
                        Color:
                            rgba: 1, 1, 1, 0.5
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    RecycleView:
                        size_hint_x: 1
						id: messages
						canvas.before:
							Color:
								rgba: 1, 1, 1, 1
							Rectangle:
								source:"assets/large-wallpaper.jpg"
								pos: self.pos
								size: self.size
						viewclass: 'MessageLabel'
                        RecycleBoxLayout:
                            default_size_hint: 1, None
                            size_hint_y: None
                            height: self.minimum_height
                            orientation: 'vertical'
                            row_default_height: 0
                    BoxLayout:
                        padding: 0
                        spacing: 0
                        id: message_box
                        height: 90
                        orientation: 'horizontal'
                        size_hint: (1, None)
                        TextInput:
                            id: message_content
                            on_text_validate: app.send()
                        Button:
                            text: 'Send'
                            on_press: app.send()
                            size_hint: (0.3, 1)
    LoginScreen:
		name: 'not_connected_screen'
		BoxLayout:
			orientation: 'vertical'
			Label:
			    size_hint_y: 0.2
                canvas.before:
                    Color:
                        rgba: 1, 0, 0, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size
                text: "Not connected!"
			GridLayout:
				LoginLabel:
					text: 'Username:'
				TextInput:
					disabled: True
				LoginLabel:
					text: 'Password'
				TextInput:

					disabled: True
			BlueButton:
				color: 0, 0, 0, 1
				text: 'Connect'
				disabled: True
			BlueButton:
				text: 'Sign up'
				color: 0, 0, 0, 1
				disabled: True